#!/bin/bash

echo "ðŸ”§ CORRECTION COMPLETE: Tous les textes du PDF"
echo "=============================================="

cd "/mnt/d/DOC G/Projets/m365-license-optimizer"

# Ã‰tapes Ã  effectuer manuellement aprÃ¨s analyse

echo "ðŸ“‹ CORRECTIONS Ã€ APPLIQUER DANS:"
echo "   backend/src/services/reports/pdf_generator.py"
echo ""
echo "ðŸŽ¯ Liste des textes Ã  remplacer:"
echo ""

# Liste complÃ¨te des traductions
python3 << 'PYEOF'
# Traductions Ã  ajouter
translations = {
    "en": {
        # Structure du PDF - Titres de sections
        "report.title.pdf_summary": "Microsoft 365 License Optimization Executive Summary",
        "report.generated_by": "Generated by",
        "report.on": "on",
        "report.tenant": "Tenant",
        "report.period": "Period",
        
        # Section KPI
        "report.total_monthly_cost": "Total Monthly Cost",
        "report.optimized_monthly_cost": "Optimized Monthly Cost", 
        "report.monthly_savings": "Monthly Savings",
        "report.annual_savings": "Annual Savings",
        "report.savings_rate": "Savings Rate",
        "report.total_users": "Total Users",
        "report.active_users": "Active Users",
        "report.total_licenses": "Total Licenses",
        
        # Sections
        "report.cost_analysis_overview": "Cost Analysis Overview",
        "report.user_license_analysis": "User License Analysis and Optimization",
        "report.license_distribution": "License Distribution",
        "report.key_findings": "Key Findings and Recommendations",
        "report.top_recommendations": "Top Recommendations by Savings",
        "report.by_departments": "Optimization Summary by Departments",
        "report.detailed_analysis": "Detailed License Analysis",
        "report.assumptions_notes": "Assumptions and Notes",
        
        # Table headers
        "report.user_principal_name": "User Principal Name",
        "report.display_name": "Display Name",
        "report.department": "Department",
        "report.job_title": "Job Title",
        "report.current_license": "Current License",
        "report.recommended_license": "Recommended License",
        "report.monthly_savings_per_user": "Monthly Savings/User",
        "report.annual_savings_per_user": "Annual Savings/User",
        "report.user_count": "User Count",
        "report.current_cost": "Current Cost",
        "report.optimized_cost": "Optimized Cost",
        "report.savings_potential": "Savings Potential",
        "report.exchange_usage_level": "Exchange Usage Level",
        "report.onedrive_usage": "OneDrive Usage",
        "report.teams_activity": "Teams Activity",
        "report.office_desktop_required": "Office Desktop Required",
        "report.last_activity_date": "Last Activity Date",
        "report.inactivity_days": "Inactivity Days",
        "report.recommendation_status": "Recommendation Status",
        "report.recommendation_reason": "Recommendation Reason",
        
        # Statuts
        "report.proposed": "Proposed",
        "report.validated": "Validated",
        "report.rejected": "Rejected",
        "report.sensitive": "Sensitive",
        "report.yes": "Yes",
        "report.no": "No",
    },
    "fr": {
        # Structure du PDF - Titres de sections
        "report.title.pdf_summary": "RAPPORT D'OPTIMISATION MICROSOFT 365",
        "report.generated_by": "GÃ©nÃ©rÃ© par",
        "report.on": "le",
        "report.tenant": "Tenant",
        "report.period": "PÃ©riode",
        
        # Section KPI
        "report.total_monthly_cost": "CoÃ»t Mensuel Total",
        "report.optimized_monthly_cost": "CoÃ»t Mensuel OptimisÃ©",
        "report.monthly_savings": "Ã‰conomies Mensuelles",
        "report.annual_savings": "Ã‰conomies Annuelles",
        "report.savings_rate": "Taux d'Ã‰conomies",
        "report.total_users": "Nombre Total d'Utilisateurs",
        "report.active_users": "Utilisateurs Actifs",
        "report.total_licenses": "Nombre Total de Licences",
        
        # Sections
        "report.cost_analysis_overview": "Vue d'ensemble de l'analyse des coÃ»ts",
        "report.user_license_analysis": "Analyse des licences utilisateur et optimisation",
        "report.license_distribution": "RÃ©partition des Licences",
        "report.key_findings": "Principales Conclusions et Recommandations",
        "report.top_recommendations": "Principales Recommandations par Ã‰conomies",
        "report.by_departments": "RÃ©sumÃ© par DÃ©partements",
        "report.detailed_analysis": "Analyse DÃ©taillÃ©e des Licences",
        "report.assumptions_notes": "HypothÃ¨ses et Notes",
        
        # Table headers
        "report.user_principal_name": "Nom d'utilisateur principal",
        "report.display_name": "Nom d'affichage",
        "report.department": "DÃ©partement",
        "report.job_title": "Titre du poste",
        "report.current_license": "Licence Actuelle",
        "report.recommended_license": "Licence RecommandÃ©e",
        "report.monthly_savings_per_user": "Ã‰conomies Mensuelles/Utilisateur",
        "report.annual_savings_per_user": "Ã‰conomies Annuelles/Utilisateur",
        "report.user_count": "Nombre d'utilisateurs",
        "report.current_cost": "CoÃ»t Actuel",
        "report.optimized_cost": "CoÃ»t OptimisÃ©",
        "report.savings_potential": "Potentiel d'Ã‰conomies",
        "report.exchange_usage_level": "Niveau d'utilisation Exchange",
        "report.onedrive_usage": "Utilisation OneDrive",
        "report.teams_activity": "ActivitÃ© Teams",
        "report.office_desktop_required": "Bureau Office Requis",
        "report.last_activity_date": "Date derniÃ¨re activitÃ©",
        "report.inactivity_days": "Jours d'inactivitÃ©",
        "report.recommendation_status": "Statut recommandation",
        "report.recommendation_reason": "Raison recommandation",
        
        # Statuts
        "report.proposed": "ProposÃ©",
        "report.validated": "ValidÃ©",
        "report.rejected": "RejetÃ©",
        "report.sensitive": "Sensible",
        "report.yes": "Oui",
        "report.no": "Non",
    }
}

# GÃ©nÃ©rer les commandes de correction
print("ðŸ“‹ TRADUCTIONS Ã€ AJOUTER DANS i18n_service.py:")
print("=" * 60)
for key in translations["en"]:
    print(f'"{key}": {{')
    print(f'  "en": "{translations["en"][key]}",')
    print(f'  "fr": "{translations["fr"][key]}",')
    print(f'}},')

print("")
print("ðŸ“ COMMANDES Ã€ EXÃ‰CUTER DANS pdf_generator.py:")
print("=" * 60)
print("grep -n 'ws\\[' pdf_generator.py | grep -E '[A-ZÃ‰]'")
print("")
print("â†’ Pour chaque ligne trouvÃ©e, remplacer le texte franÃ§ais par:")
print("   i18n_service.translate('report.clÃ©', language)")
print("")
print("ðŸŽ¯ Exemple concret:")
print('  Avant: ws["A5"] = "INDICATEURS CLÃ‰S"')
print("  AprÃ¨s: ws['A5'] = i18n_service.translate('report.kpi_section', language).upper()")
print("")

PYEOF

# CrÃ©er le script de correction
python3 << 'PYEOF'
# Ce script sera gÃ©nÃ©rÃ© automatiquement aprÃ¨s analyse du PDF
print("âœ… Script de correction gÃ©nÃ©rÃ©")
PYEOF

echo ""
echo "ðŸŽ‰ PROCÃ‰DURE COMPLETE:"
echo "======================"
echo ""
echo "1ï¸âƒ£  Copiez les traductions ci-dessus dans i18n_service.py"
echo "    â†’ Ajoutez-les dans les sections 'en' et 'fr'"
echo ""
echo "2ï¸âƒ£  Ouvrez backend/src/services/reports/pdf_generator.py"
echo "    â†’ Recherchez TOUS les textes entre guillemets avec accents"
echo "    â†’ Remplacez chacun par la traduction correspondante"
echo ""
echo "3ï¸âƒ£  Exemples de remplacement:"
echo '      - Avant: ws["A5"] = "INDICATEURS CLÃ‰S"'
echo "      - AprÃ¨s:  ws['A5'] = i18n_service.translate('report.kpi_section', language).upper()"
echo ''
echo '      - Avant: ws["A7"] = "CoÃ»t actuel mensuel"'
echo "      - AprÃ¨s:  ws['A7'] = i18n_service.translate('report.current_monthly_cost', language)"
echo ""
echo "4ï¸âƒ£  RedÃ©marrez le backend:"
echo "    docker-compose restart backend"
echo ""
echo "5ï¸âƒ£  GÃ©nÃ©rez un nouveau PDF et vÃ©rifiez qu'il est entiÃ¨rement en anglais"
echo ""
echo "ðŸ“ž Si vous avez des doutes sur un texte spÃ©cifique:"
echo "    â†’ Faites une capture d'Ã©cran du PDF"
echo "    â†’ Notez le texte exact"
echo "    â†’ Envoyez-la-moi pour traduction prÃ©cise"
echo ""

echo "âœ… CORRECTION COMPLEÃˆTE PRÃŠTE!"
